---
title: "Env-Chem_Gen-Code"
author: "J.Behrens"
date: "11/30/2020"
output: html_document
---

# Set-Up R Environment
```{r setup}
## Clear environment
rm(list = ls())

## Libraries
library(dataRetrieval)
library(tidyverse)
library(openxlsx)
library(leaflet)                                           
library(reshape2)
library(knitr)

#Set working directory
opts_knit$set(root.dir = "C:/Users/jbehr/OneDrive - Duke University/Documents/5. R/General_Env_Chem")
```

# Download Data

For now, just looking at organic contaminants on the USGS PCode List (NWIS).

```{r}
USGS_Param<-read.xlsx("raw_data/RAW_USGS-Param-Codes.xlsx") %>% 
  mutate(casrn = str_replace_all(casrn, "-",""))

CompTox<-read.xlsx("raw_data/RAW_CompToxChemicalsDashboard-All-USGS-PCs.xlsx") %>% 
  mutate(CASRN = str_replace_all(CASRN, "-",""))

CompTox_Lists<-read.csv("raw_data/CompToxChemicalsDashboard-Batch-Search_2020-11-30.csv") %>% 
  gather(LISTS, Yes_or_No, 6:293) %>% 
  filter(Yes_or_No == "Y") %>% 
  select(!Yes_or_No) %>% #These three lines consolidates the lists, and removes categories the cmpd is not in
  arrange(-desc(PREFERRED_NAME))  

TSCA_List<-read.csv("raw_data/TSCAINV_062020.csv")

```

# Merge Datasets
```{r}

CompTox_List_Names<-read.xlsx("raw_data/CompTox_Lists.xlsx")
CompTox_Lists<-left_join(CompTox_Lists, CompTox_List_Names)

CompTox_Lists %>% 
  group_by(LISTS) %>%   
  count() %>%
  full_join(CompTox_List_Names) %>% 
  arrange(desc(n)) %>% 
  view()

```

#Some simple stats
```{r}

Categories<-CompTox_Lists %>% 
  distinct_()
  filter(Gen_Type == "Category") %>%
  group_by(PREFERRED_NAME, Specific_Type) %>% 
  distinct(.keep_all = TRUE) 








full_1<-USGS_Param %>%   
  group_by(parameter_group_nm) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  view()
  filter(!str_detect(parameter_group_nm, 
                    "inorganic")) 



full<-Categories %>% 
  group_by(Specific_Type) %>% 
  count() %>% 
  arrange(desc(n)) %>% 
  view()

USGS<-USGS_Param %>% 
  distinct(casrn, .keep_all = )



```



# Plot: By Decade

```{r}

#OLD CODE

Year_Plot<- Both_Water %>% 
  ggplot(aes(x=as.character(Decade), fill=Site_Group)) +
  geom_bar() +
  theme_classic() + 
  theme(axis.text.x = element_text(angle=45, hjust = 1)) + 
  labs(title="Both Areas by Decade")
print(Year_Plot)
##ggsave("output/Years.png")

Year_4_site_Plot<- Both_Water  %>% 
  filter(str_detect(MonitoringLocationIdentifier, 
                    "USGS-02085500|USGS-02086500|USGS-02086849|J1269000")) %>% 
  ggplot(aes(x=as.character(Decade), fill=MonitoringLocationName)) +
  geom_bar() +
  theme_classic() + 
  theme(axis.text.x = element_text(angle=45, hjust = 1)) + 
  labs(title="Both Areas by Decade")
print(Year_4_site_Plot)
##ggsave("output/Years_4_sites.png")

decade_EC_Plot<-Ellerbe_Creek_Water %>% 
  ggplot(aes(x=MonitoringLocationIdentifier, fill = as.character(Decade))) +
  geom_bar() +
  theme_classic() + 
  theme(axis.text.x = element_text(angle=45, hjust = 1)) + 
  labs(title="Ellerbe Creek by Decade")
print(decade_EC_Plot)
##ggsave("output/Decades_EC.png")

decade_FR_Plot<-Flat_River_Water %>% 
  ggplot(aes(x=MonitoringLocationIdentifier, fill = as.character(Decade))) +
  geom_bar() +
  theme_classic() + 
  theme(axis.text.x = element_text(angle=45, hjust = 1)) + 
  labs(title="Flat River by Decade")
print(decade_FR_Plot)
##ggsave("output/Decades_FR.png")
```